{% extends "layout.html" %}

{% block title %}
    Edit Class
{% endblock %}

{% block main %}
<script>
    function deleteClassEntry(class_join_id) {
        
        console.log(class_join_id);
        if (confirm("Are you sure you want to delete this class?"))
        {
            
            var form = document.createElement("form");
            form.method = "post";
            form.action = "/delete_entry";
            var input = document.createElement("input");
            input.type = "hidden";
            input.name = "class_join_id";
            input.value = class_join_id;
            form.appendChild(input);
            document.body.appendChild(form);
            form.submit();
        }
    }

    function populateDropdowns(roleType) {
        var employeeDropdown = document.getElementById("employeeDropdown");
        var servicesDropdown = document.getElementById("servicesDropdown");
        employeeDropdown.innerHTML = "";
        servicesDropdown.innerHTML = "";
        if (roleType === "teacher") {
            {% for teacher in teachers %}
                var option = document.createElement("option");
                option.value = "{{ teacher.id }}";
                option.text = "{{ teacher.name }}";
                employeeDropdown.appendChild(option);
            {% endfor %}
            {% for service in teacher_services %}
                var option = document.createElement("option");
                option.value = "{{ service.id }}";
                option.text = "{{ service.service }}";
                servicesDropdown.appendChild(option);
            {% endfor %}
        } else if (roleType === "student") {
            {% for student in students %}
                var option = document.createElement("option");
                option.value = "{{ student.id }}";
                option.text = "{{ student.name }}";
                employeeDropdown.appendChild(option);
            {% endfor %}
            {% for service in student_services %}
                var option = document.createElement("option");
                option.value = "{{ service.id }}";
                option.text = "{{ service.service }}";
            servicesDropdown.appendChild(option);
            {% endfor %}
        }
    }
</script>
{% if date %}

<div style="text-align: left;">
    <form method="get" action="/class_edit">
        Select Class Date - 
        <select name="date" onchange="this.form.submit()">
            <option value="" selected disabled hidden>Date</option>
            {% for date in dates %}
            <option value="{{ date.date }}">{{ date.date }}</option>
            {% endfor %}
        </select>
        </select>
        <!-- <button type="submit" hidden>Go to this class</button> -->
    </form>
</div>

<hr>

<div>
    <form method="post" action="/class_edit">
        <input type="hidden" name="class_date" value="{{date[0].date}}">
        <input type="hidden" name="class_id" value="{{classID}}">
        <!-- <select name="role_type" onchange="populateDropdowns(this.value)" required>
            <option value="" selected disabled hidden>Select Role</option>
            <option value="teacher">Teacher</option>
            <option value="student">Student</option>
        </select>
        <select name="employee" id="employeeDropdown" required>
            <option value="" selected disabled hidden>Select Employee</option>
        </select>
        <select name="services" id="servicesDropdown" required>
            <option value="" selected disabled hidden>Select class role</option>
        </select> -->
        <!-- <button type="submit" name="add_teacher">Add</button>    -->
        <select name="employee" id="employeeDropdown" required>
            <option value="" selected disabled hidden>Select Teacher</option>
            {% for teacher in teachers %}
                <option value="{{ teacher.id }}">{{ teacher.name }}</option>
            {% endfor %}    
        </select>
        <select name="services" id="servicesDropdown" required>
            <option value="" selected disabled hidden>Select class role</option>
            {% for service in teacher_services %}
                <option value="{{ service.id }}">{{ service.service }}</option>
            {% endfor %}
        </select>
        <input type="submit" name="add_employee" value="Add Teacher" style="border-radius: 10%; background-color: lightblue; border: none;">
        <p></p>
    </form>
    <form method="post" action="/class_edit">
        <input type="hidden" name="class_date" value="{{date[0].date}}">
        <input type="hidden" name="class_id" value="{{classID}}">
        <select name="employee" id="employeeDropdown" required>
            <option value="" selected disabled hidden>Select Student</option>
            {% for student in students %}
                <option value="{{ student.id }}">{{ student.name }}</option>
            {% endfor %}    
        </select>
        <select name="services" id="servicesDropdown" required>
            <option value="" selected disabled hidden>Select model type</option>
            {% for service in student_services %}
                <option value="{{ service.id }}">{{ service.service }}</option>
            {% endfor %}
        </select>
        <input type="submit" name="add_employee" value="Add Student" style="border-radius: 10%; background-color: lightblue; border: none;">
        <p></p>
    </form>

    <hr>
    {% endif %}
<div>
    <h3>{{date[0].date}}</h3>

    {% if classes %}
    
        <table>
            {% for class in classes %}
            <tr>
                <td>
                    {{ class.employee_name }} - 
                    {{ class.service_name }}
                </td>
                <td><input type="button" name="delete{{class.class_join_id}}" id="{{class.class_join_id}}" value="Delete" style="border-radius: 10%; background-color: lightblue; border: none;" onclick="deleteClassEntry({{class.class_join_id}})"></td>
            </tr>
            </tr>
            </tr>
            {% endfor %}
        </table>
        <hr>
        <form method="post" action="/class_update">
            <table style="border: 2px solid darkgray;">
                <tr>
                    <td>Class Topic</td>
                    <td>Notes</td>
                </tr>
                <tr>
                    <td>
                        <input type="text" name="theory_topic", value="{{classes[0].theory_topic}}">
                    </td>
                    <td>
                        <textarea name="notes" rows="4" cols="50">{{classes[0].notes}}</textarea>
                    </td>
                </tr>
                <tr style="align-content: center;">
                    <td></td>
                    <td>
                        <input type="hidden" name="class_id" value="{{classID}}">
                        <input type="hidden" name="class_date" value="{{date[0].date}}">
                        <button type="submit" name="update">Update</button>
                    </td>
                </tr>
            </table>
            </table>
        </form>
{% else %}
    <p>This class is currently empty</p>
{% endif %}
</div>


</div>
{% endblock %}
